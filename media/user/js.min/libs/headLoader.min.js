/**
 * @link : https://github.com/baiyukey/headLoader
 * @version : 2.4.2
 * @copyright : http://www.uielf.com
 */
function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var s=t[r](o),i=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}("next")})}}const headLoaderSource=function(){const e="null"===window.location.origin||window.location.origin===window.top.location.origin?window.top:window,t=document.getElementsByTagName("HEAD").item(0);if(!e.Promise)return e.onload=function(){document.body.innerHTML='<div style="text-align:center"><ul style="display:inline-block;margin-top:20px;text-align:left;list-style:none;line-height:32px;"><li style="list-style:none;"><h3>抱歉，您的浏览器不支持运行当前页面！</h3>如下两种方法供您参考：</li><li>✱ 请将您的浏览器切换到 "极速内核" (如果有)。</li><li>✱ <a href="https://www.google.cn/chrome/">或者下载安装 "chrome" 浏览器后重试。</a></li></ul></div>'};const n=e.XMLHttpRequest,a=/^((192\.168|172\.([1][6-9]|[2]\d|3[01]))(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}|10(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){3})|(localhost)|(127.0.0.1)$/.test(e.location.hostname)?"":".min",r=function(e,t){if(""===a)return(new Date).getTime()+1e3*(t||0)*60*60;let n=new Date("2000/1/1").getTime();return n+1e3*Math.ceil(((new Date).getTime()-n)/(36e5*e))*60*60*e+1e3*(t||0)*60*60},o=e=>e.replace(/^.*\.(\w*)[?#]*.*$/,"$1");let s=new function(){let e="";for(let t=48;t<=122;t++)t>=58&&t<=64||t>=91&&t<=96||(e+=String.fromCharCode(t));let t=(e=(e=e.replace(/[aeiouAEIOU01]/g,"")).slice(0,18)+"$-_+!*"+e.slice(18)).length,n=location.host.length,a=-1,r="",o="";this.encode=function(s){r=encodeURIComponent(s).replace(/\./g,"&dot"),o="",a=-1;for(let s=0;s<r.length;s++)a=e.indexOf(r.charAt(s)),o+=a<0?r.charAt(s):e.charAt((a+n)%t);return o}},i=function(t){let n={database:"localDB",tables:{data:["key","value","version"]},version:r(".min"===a?24:0)};Object.assign(n,t);e.localDBResult=e.localDBResult||null,e.localDBStatus=e.localDBStatus||0;const o=function(){return void 0!==e.waitCloseLocalDB&&clearTimeout(e.waitCloseLocalDB),new Promise((t,a)=>{if(null!==e.localDBResult&&1===e.localDBStatus)return void t("success");let r=e.indexedDB.open(n.database);r.onerror=function(e){a(e)},r.onsuccess=function(n){e.localDBResult=r.result,e.localDBStatus=1,t(n)},r.onupgradeneeded=function(a){e.localDBResult=a.target.result,e.localDBStatus=1;let r=Object.keys(n.tables);for(const t of r)if(!e.localDBResult.objectStoreNames.contains(t)){let a=e.localDBResult.createObjectStore(t,{keyPath:"key"});n.tables[t].forEach(e=>a.createIndex(e,["key"],{unique:!0}))}a.target.transaction.oncomplete=(()=>t(e.localDBResult))}})},i=function(t){return void 0!==e.waitCloseLocalDB&&clearTimeout(e.waitCloseLocalDB),new Promise((n,a)=>{e.waitCloseLocalDB=setTimeout(function(){e.localDBResult&&e.localDBResult.close(),e.localDBStatus=0,n("success")},t||3e3)})},l=(u=_asyncToGenerator(function*(){if(!e.localDBResult)return console.warn(`目前还没有库${n.database}`);yield i(0),e.indexedDB.deleteDatabase(n.database),D&&console.log(`${n.database}已删除`)}),function(){return u.apply(this,arguments)});var u;const d=function(){let t={tableName:"data",key:"",value:null,etag:""};return"object"==typeof arguments[0]?Object.assign(t,arguments[0]):(t.key=arguments.length>0?arguments[0]:t.key,t.value=arguments.length>1?arguments[1]:t.value,t.tableName=arguments.length>2?arguments[2]:t.tableName),new Promise((r=_asyncToGenerator(function*(r,i){yield o();let l={key:".min"===a?s.encode(t.key):t.key,value:t.value,etag:t.etag,version:n.version},c="add";yield h(t.key).then(function(e){c=e?"put":"add"}).catch(function(e){c="add"});let u=e.localDBResult.transaction(t.tableName,"readwrite").objectStore(t.tableName)[c](l);u.onsuccess=function(){r(l)},u.onerror=function(e){i(e.target.error)}}),function(e,t){return r.apply(this,arguments)}));var r},h=function(t,n){return new Promise((r=_asyncToGenerator(function*(r,i){let l={},c=(u=_asyncToGenerator(function*(){yield o();let c=n||"data",u=e.localDBResult.transaction(c,"readonly").objectStore(c),d=".min"===a?s.encode(t):t,h=u.index("key").get([d]);h.onsuccess=function(e){(l=e.target.result)&&Object.assign(l,{key:t}),r(l)},h.onerror=function(e){return i(e)}}),function(){return u.apply(this,arguments)});var u;if(l=j.temp[t])return r(l),!0;yield c()}),function(e,t){return r.apply(this,arguments)}));var r},f=(y=_asyncToGenerator(function*(e){let t=yield h(e);return!!t&&t.value}),function(e){return y.apply(this,arguments)});var y;const p=(m=_asyncToGenerator(function*(e,t){let n=c(e,"css");return yield h(j.getUrl(n,"css"),t||"data")}),function(e,t){return m.apply(this,arguments)});var m;const g=(b=_asyncToGenerator(function*(e,t){let n=c(e,"html");return yield h(j.getUrl(n,"html"),t||"data")}),function(e,t){return b.apply(this,arguments)});var b;const v=(w=_asyncToGenerator(function*(e,t){let n=c(e,"js");return yield h(j.getUrl(n,"js"),t||"data")}),function(e,t){return w.apply(this,arguments)});var w;const T=(L=_asyncToGenerator(function*(e){let t=yield h(e);return!!t&&((e,t)=>{let n=[],a=new Uint8Array(e);for(let e=0;e<a.byteLength;e++)n.push(String.fromCharCode(a[e]));return`data:image/${t};base64,${window.btoa(n.join(""))}`})(t.value,(e=>{let t=e.replace(/^.*\.(\w*)[?#]*.*$/,"$1");return e!==t&&t})(e)||"jpeg")}),function(e){return L.apply(this,arguments)});var L;(function(){return!!(e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB)||(console&&console.log("您的浏览器不支持indexedDB，请使用现代浏览器，例如chrome,firefox等."),!1)})&&(this.open=o,this.close=i,this.delete=l,this.setItem=d,this.getItem=h,this.setValue=d,this.getValue=f,this.getCss=p,this.getHtml=g,this.getJs=v,this.getBase64=T,this.temp={});let j=this};e.localDB=i;let l,c=(e,t)=>e&&t?e.replace(/^(\s*)|(\s*)$/g,"").replace(`(.${t})`,""):e&&!t?e.replace(/^(\s*)|(\s*)$/g,"").replace(`(.${o(e)}`,""):console.error("模块格式错误"),u=function(s){let l=s||{};this.dataMin=a,this.dataDir=l.dataDir||"",this.dataCss=l.dataCss||[],this.dataJs=l.dataJs||[],this.dataFont=l.dataFont||[],this.dataFile=l.dataFile||[],this.lifeCycle=l.lifeCycle||24,this.cycleDelay=l.cycleDelay||0,this.dataActive=l.dataActive||m,this.callback=l.callback||null,this.multiLoad=l.multiLoad||".min"===a,this.showLog=l.showLog||!1,this.preload=void 0!==l.preload?l.preload:0;let u=function(e,t){t.length>0&&t.forEach(function(t){e.setAttribute(t.split("=")[0],t.split("=")[1])})};void 0===e.headLoaderCache&&(e.headLoaderCache={});let d=function(e,t,n){return _.dataActive&&["js","css"].includes(t)?`${_.dataDir}${t}${a}/${e.split("|")[0]}`.replace("."+(n||t),"")+a+"."+(n||t):e},h=function(e,t){return["js","css"].includes(t)?(_.dataDir+t+a+"/"+e.split("|")[0]).replace("."+t,"")+a+"."+t:e},f=function(e,t){return new Promise((r,o)=>{if(!e)return r(2);Number(e.version)<Number(_.requestVersion)?""===e.etag?r(2):(a=t,new Promise((e,t)=>{let r=new n;r.open("HEAD",a,!0),r.send(),r.onreadystatechange=function(){4===Number(r.readyState)&&200===Number(r.status)&&e(r.getResponseHeader("etag")||r.getResponseHeader("last-modified")||"")},r.onerror=(e=>t(e))})).then(t=>{e.etag===t?r(1):r(2)}).catch(e=>o(e)):r(0)});var a},y=function(e,t){return new Promise((r,s)=>{if((e=>/^http[s]?:\/\//.test(e))(e))return"js"===t?T(e):"css"===t&&j(e),r("success");let i=d(e,t)+(e.indexOf("?")>=0?"&v=":"?v=")+_.requestVersion,l=h(e,t),c=(a=_asyncToGenerator(function*(e,t){let a={};if(Object.assign(a,{key:l,value:t?t.value:"",etag:t?t.etag:"",version:t?t.version:_.requestVersion}),0===e)_.db.temp[l]=a,r("success");else if(1===e)_.db.temp[l]=a,r("success"),a.version=_.requestVersion,yield _.db.setItem(a);else if(2===e){let e=new n,t=o(a.key),c="responseText";e.open("GET",i),["js","ts","css","svg","text","xml","json","html","htm"].includes(t)||(e.responseType="arraybuffer",c="response"),e.send(),e.onreadystatechange=_asyncToGenerator(function*(){if(4===Number(e.readyState)&&200===Number(e.status)){let t=e[c];Object.assign(a,{value:t,etag:e.getResponseHeader("etag")||e.getResponseHeader("last-modified")||"",version:_.requestVersion}),_.showLog&&v++,_.db.temp[l]=a,r("success"),yield _.db.setItem(a)}else 404===Number(e.status)&&(a.value=a.key,_.showLog&&v++,_.db.temp[l]=a,r(`${a.key} 404 error!`))}),e.onerror=function(e){return s(e)}}}),function(e,t){return a.apply(this,arguments)});_.db.getItem(l).then(e=>{f(e,i).then(t=>c(t,e)).catch(e=>console.error(e))})});var a},p=function(e){if(""!==a)return Function(Object.values(e).join(";"))(),!0;let n=document.createElement("script"),r=1===Object.keys(e).length?Object.keys(e)[0]:"_js"+_.requestVersion;r=r.split("|")[0].replace(/(\.css)|(\.min)/g,""),n.setAttribute("type","text/javascript"),n.setAttribute("data-name",r),n.innerHTML=Object.values(e).join(";"),t.appendChild(n)},g=function(e){let n,r=1===Object.keys(e).length?Object.keys(e)[0]:"_css"+_.requestVersion;if(r=r.split("|")[0].replace(/(\.css)|(\.min)/g,""),""!==a&&null!==(n=t.querySelector(`[data-name=${r}]`)))return n.innerHTML+=Object.values(e).join(" "),!1;(n=document.createElement("style")).setAttribute("type","text/css"),n.setAttribute("data-name",r),n.innerHTML=Object.values(e).join(" "),t.appendChild(n)},b=(D=_asyncToGenerator(function*(e){Object.keys(e).forEach(function(t){document.fonts.add(new FontFace(t.replace(/^.*\/|\..*$/g,""),e[t]))})}),function(e){return D.apply(this,arguments)});var D;let T=function(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let n=document.createElement("script");u(n,e.split("|").splice(1)),n.src=0===e.indexOf("http")?e.split("|")[0]:e.split("|")[0].replace(".js","")+a+".js?v="+_.requestVersion,t.appendChild(n)},j=function(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let n=document.createElement("link");u(n,e.split("|").splice(1)),n.type="text/css",n.rel="stylesheet",n.media="screen",n.href=0===e.indexOf("http")?e.split("|")[0]:e.split("|")[0].replace(".css","")+a+".css?v="+_.requestVersion,t.appendChild(n)},A=(S=_asyncToGenerator(function*(e,t){return new Promise(function(n,a){let r,o={JS:p,CSS:g,FONT:b}[t.toUpperCase()],s={},i=[];e.forEach(function(e){s[e]="";i.push(new Promise(function(n,a){r=h(e,t),s[e]=_.db.temp[r]?_.db.temp[r].value:"",_.returnData.push({key:e,value:s[e]}),n("success")}))}),Promise.all(i).then(function(){return 1===_.preload?(n("success"),!1):o?(o(s),void n("success")):n("页面写入仅支持js、css、font")}).catch(function(e){return a(e)})})}),function(e,t){return S.apply(this,arguments)});var S;let C=function(e,t){return e&&0!==e.length?new Promise(_.multiLoad?function(e,t){return n=_asyncToGenerator(function*(n){let a=new Array(e.length).fill(0).map(function(n,a){return new Promise((r=_asyncToGenerator(function*(n){yield y(e[a],t),n("success")}),function(e){return r.apply(this,arguments)}));var r});var r;Promise.all(a).then((r=_asyncToGenerator(function*(a){yield A(e,t),n("success")}),function(e){return r.apply(this,arguments)}))}),function(e){return n.apply(this,arguments)};var n}(e,t):function(e,t){return n=_asyncToGenerator(function*(n){let a=0,r=(o=_asyncToGenerator(function*(){if(a>=e.length)return!0;yield y(e[a],t),yield A([e[a]],t),yield r(a++)}),function(){return o.apply(this,arguments)});var o;yield r(),n("success")}),function(e){return n.apply(this,arguments)};var n}(e,t)):new Promise(e=>e("success"))};var B,F,k,x;this.db=new i({version:this.requestVersion}),this.db.temp={},this.db.getUrl=d,this.returnData={},this.run=_asyncToGenerator(function*(){return _.requestVersion=r(_.lifeCycle,_.cycleDelay),_.db=new i({version:_.requestVersion}),this.db.temp={},this.db.getUrl=d,this.returnData={},_.returnData=[],_.dataCss=_.dataCss.map(function(e){return c("_css"===e?L:e,"css")}),_.dataCss=Array.from(new Set(_.dataCss)),_.dataJs=_.dataJs.map(function(e){return c("_js"===e?L:e,"js")}),_.dataJs=Array.from(new Set(_.dataJs)),_.dataFont=_.dataFont.map(function(e){return c(e,"")}),_.dataFont=Array.from(new Set(_.dataFont)),_.dataFile=_.dataFile.map(function(e){return c(e,"")}),_.dataFile=Array.from(new Set(_.dataFile)),yield _.db.open(),yield C(_.dataCss,"css"),yield C(_.dataFont,"font"),yield C(_.dataJs,"js"),yield C(_.dataFile,""),_.showLog&&function(){let t=(new Date).getTime()-w;e.headLoaderHistory=void 0!==e.headLoaderHistory?e.headLoaderHistory:[],void 0!==e.showLogTimeout&&clearTimeout(e.showLogTimeout),e.showLogTimeout=setTimeout(()=>{v>0&&(e.headLoaderHistory=e.headLoaderHistory.concat(new Array(v-1).fill(0),t));let n=0,a=0;e.headLoaderHistory.length>0&&(n=e.headLoaderHistory.reduce((e,t)=>e+t),a=Math.ceil(n/e.headLoaderHistory.length)),console.log("当前页面使用headLoader"+(_.multiLoad?"并行":"串行")+"网络请求%c"+v+"个%cJS/CSS文件，程序用时%c"+t+"毫秒%c，累计网络请求%c"+e.headLoaderHistory.length+"个%cJS/CSS文件，单文件平均用时%c"+a+"毫秒","color:#1b8884","","color:#1b8884","","color:#1b8884","","color:#1b8884","")},3e3)}(),"function"==typeof _.callback&&_.callback.call(_,_.returnData),0!==_.returnData.length&&(1===_.returnData.length?_.returnData[0]:_.returnData)}),this.loadFile=(B=_asyncToGenerator(function*(e,t){return _.dataCss=[],_.dataJS=[],_.dataFont=[],_.dataFile=[e].flat(),_.preload=1,yield _.run()}),function(e,t){return B.apply(this,arguments)}),this.loadJs=(F=_asyncToGenerator(function*(e){return _.dataCss=[],_.dataJs=[e].flat(),_.dataFont=[],_.dataFile=[],_.preload=1,yield _.run()}),function(e){return F.apply(this,arguments)}),this.loadCss=(k=_asyncToGenerator(function*(e){return _.dataCss=[e].flat(),_.dataJS=[],_.dataFont=[],_.dataFile=[],_.preload=1,yield _.run()}),function(e){return k.apply(this,arguments)}),this.loadFont=(x=_asyncToGenerator(function*(e){return _.dataCss=[],_.dataJS=[],_.dataFont=[e].flat(),_.dataFile=[],_.preload=1,yield _.run()}),function(e){return x.apply(this,arguments)}),this.nextLife=function(e,t){let n=e||_.lifeCycle,a=t||_.cycleDelay;return new Date(r(n,a)).toLocaleString()};let _=this};e.headLoader=u,e.hLoader=u;let d,h=[],f=[],y=[],p=[],m=!1,g=24,b=0,v=1,w=(new Date).getTime();l=document.currentScript;let D=console.log&&".min"!==a,T=!1,L=(window===window.top?location.pathname:window.frameElement.getAttribute("src")||window.frameElement.pathname||"/404.html").replace(/^(.*\/)(.*)(\.html)([?]*)(.*)$/,"$1$2$4$5");var j;"/"===L.substr(-1)&&(L+="index"),L=0===L.indexOf("/")?L.substr(1):L,l.hasAttribute("data-active")?m=["true",""].includes(l.getAttribute("data-active")):D&&console.log('%c友情提示:script标签未设置"data-active"属性,默认为false.',"color:#69F;"),l.hasAttribute("data-lifecycle")&&(g=Number(l.getAttribute("data-lifecycle"))),l.hasAttribute("data-cycledelay")?b=Number(l.getAttribute("data-cycledelay")):D&&console.log('%c友情提示:script标签未设置"data-lifeCycle"属性,默认为0(开发环境)或24小时(线上环境）.',"color:#69F;"),l.hasAttribute("data-dir")?d=l.getAttribute("data-dir"):D&&console.log('%c友情提示:script标签未设置"data-dir"属性.',"color:#69F;"),l.hasAttribute("data-css")?f=l.getAttribute("data-css").split(","):D&&console.log('%c友情提示:script标签未设置"data-css"属性',"color:#69F;"),l.hasAttribute("data-js")?h=l.getAttribute("data-js").split(","):D&&console.log('%c友情提示:script标签未设置"data-js"属性',"color:#69F;"),l.hasAttribute("data-font")&&(y=l.getAttribute("data-font").split(",")),l.hasAttribute("data-file")&&(p=l.getAttribute("data-file").split(",")),l.hasAttribute("data-showlog")&&(T=["true",""].includes(l.getAttribute("data-showlog"))),""!==a&&l.remove(),(j=_asyncToGenerator(function*(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let t=new u;t.lifeCycle=g,t.cycleDelay=b,d&&(t.dataDir=d),f.length>0&&(t.dataCss=f),h.length>0&&(t.dataJs=h),y.length>0&&(t.dataFont=y),p.length>0&&(t.dataFile=p),t.showLog=T;let n=l.src.replace(/.+\.js(.*)/,"$1");if(n!==l.src&&""!==n){let e=yield t.db.getValue("srcSearch");(!e||e&&e!==n)&&(yield t.db.delete(),yield t.db.setValue("srcSearch",n),localStorage.clear())}yield t.run()}),function(e){return j.apply(this,arguments)})()};headLoaderSource(),getHeaderLoader=(e=>`function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var s=t[r](o),i=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}("next")})}} const headLoaderSource=${headLoaderSource};headLoaderSource()`);
