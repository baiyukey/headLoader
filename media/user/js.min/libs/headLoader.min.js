/**
 * @link : https://github.com/baiyukey/headLoader
 * @version : 2.5.6
 * @copyright : http://www.uielf.cn
 */
function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var i=t[r](o),l=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(l).then(function(e){a("next",e)},function(e){a("throw",e)});e(l)}("next")})}}const headLoaderSource=function(){const e="null"===window.location.origin||window.location.origin===window.top.location.origin?window.top:window,t=document.getElementsByTagName("HEAD").item(0),n=e=>Object.prototype.toString.call(e).slice(8,-1);if(!e.Promise)return e.onload=function(){document.body.innerHTML='<div style="text-align:center"><ul style="display:inline-block;margin-top:20px;text-align:left;list-style:none;line-height:32px;"><li style="list-style:none;"><h3>抱歉，您的浏览器不支持运行当前页面！</h3>如下两种方法供您参考：</li><li>✱ 请将您的浏览器切换到 "极速内核" (如果有)。</li><li>✱ <a href="https://www.google.cn/chrome/">或者下载安装 "chrome" 浏览器后重试。</a></li></ul></div>'};const a=e.XMLHttpRequest,r=/^(((192\.168|172\.([1][6-9]|[2]\d|3[01]))(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){2}|10(\.([2][0-4]\d|[2][5][0-5]|[01]?\d?\d)){3})|(localhost)|(127.0.0.1))$/.test(e.location.hostname)?"":".min",o={0:"网络连接失败。",404:"该资源找不到了。",500:"无权访问。",503:"该请求已被阻止。"},i=function(e,t){if(""===r)return Date.now();let n=new Date("2000/1/1").getTime();return n+1e3*Math.ceil((Date.now()-1e3*(t||0)*60*60-n)/(36e5*e))*60*60*e+1e3*(t||0)*60*60},l=e=>e.replace(/^.*\.(\w*)[?#]*.*$/,"$1");let s=new function(){let e="";for(let t=48;t<=122;t++)t>=58&&t<=64||t>=91&&t<=96||(e+=String.fromCharCode(t));let t=(e=(e=e.replace(/[aeiouAEIOU01]/g,"")).slice(0,18)+"$-_+!*"+e.slice(18)).length,n=location.host.length,a=-1,r="",o="";this.encode=function(i){r=encodeURIComponent(i).replace(/\./g,"&dot"),o="",a=-1;for(let i=0;i<r.length;i++)a=e.indexOf(r.charAt(i)),o+=a<0?r.charAt(i):e.charAt((a+n)%t);return o}},c=function(t){let a={database:"localDB",tables:{data:["key","value","version"]},version:0,lifeCycle:0,cycleDelay:0};Object.assign(a,t),"Array"===n(t.lifeCycle)&&(a.lifeCycle=t.lifeCycle[0],a.cycleDelay=t.lifeCycle[1]),a.version=i(a.lifeCycle,a.cycleDelay);e.localDBResult=e.localDBResult||null,e.localDBStatus=e.localDBStatus||0;const o=function(t){return void 0!==e.waitCloseLocalDB&&clearTimeout(e.waitCloseLocalDB),new Promise((t,n)=>{if(null!==e.localDBResult&&1===e.localDBStatus)return void t("success");let r=e.indexedDB.open(a.database);r.onerror=function(e){n(e)},r.onsuccess=function(n){e.localDBResult=r.result,e.localDBStatus=1,t(n)},r.onupgradeneeded=function(n){e.localDBResult=n.target.result,e.localDBStatus=1;let r=Object.keys(a.tables);for(const t of r)if(!e.localDBResult.objectStoreNames.contains(t)){let n=e.localDBResult.createObjectStore(t,{keyPath:"key"});a.tables[t].forEach(e=>n.createIndex(e,["key"],{unique:!0}))}n.target.transaction.oncomplete=(()=>t(e.localDBResult))}})},l=function(t=300){return new Promise((n,a)=>{void 0!==e.waitCloseLocalDB&&clearTimeout(e.waitCloseLocalDB);const r=()=>{if(e.localDBResult&&1===e.localDBStatus)try{e.localDBResult.close(),e.localDBStatus=0,e.localDBResult=null,n(!0)}catch(e){console.error("强制关闭数据库失败:",e),a(e)}else n(!1)};t>0?e.waitCloseLocalDB=setTimeout(()=>{r()},t):r()})},c=function(){return new Promise((e=_asyncToGenerator(function*(e,t){try{yield l(0);let r=0;const o=10,i=300,s=(n=_asyncToGenerator(function*(){const n=indexedDB.deleteDatabase(a.database);n.onsuccess=function(){console.log("数据库删除成功"),e(!0)},n.onerror=function(e){console.error("删除数据库出错:",e.target.error),t(e.target.error)},n.onblocked=function(){++r>=o?t(new Error(`删除被阻塞，已达到最大重试次数 ${o}`)):(console.log(`删除被阻塞，等待其他连接关闭... (重试 ${r}/${o})`),l(0).then(function(){setTimeout(s,i*r)}))}}),function(){return n.apply(this,arguments)});yield s()}catch(e){t(new Error(`关闭数据库连接失败: ${e.message}`))}var n}),function(t,n){return e.apply(this,arguments)}));var e},u=function(){let t={tableName:"data",key:"",value:null,etag:""};return"object"==typeof arguments[0]?Object.assign(t,arguments[0]):(t.key=arguments[0]||t.key,t.value=arguments[1]||t.value,t.tableName=arguments[2]||t.tableName),new Promise((n=_asyncToGenerator(function*(n,i){yield o();let c={key:".min"===r?s.encode(t.key):t.key,value:t.value,etag:t.etag,version:a.version},u="add";if(yield f(t.key).then(function(e){u=e?"put":"add"}).catch(function(e){u="add"}),!e.localDBResult)return void n(!1);let d=e.localDBResult.transaction(t.tableName,"readwrite").objectStore(t.tableName)[u](c);var y;d.onsuccess=_asyncToGenerator(function*(){n(c),yield l()}),d.onerror=(y=_asyncToGenerator(function*(e){i(e.target.error),yield l()}),function(e){return y.apply(this,arguments)})}),function(e,t){return n.apply(this,arguments)}));var n},f=function(t,n){return new Promise((a=_asyncToGenerator(function*(a,i){let l={},c=(u=_asyncToGenerator(function*(){yield o();let c=n||"data",u=e.localDBResult.transaction(c,"readonly").objectStore(c),d=".min"===r?s.encode(t):t,f=u.index("key").get([d]);f.onsuccess=function(e){(l=e.target.result)&&Object.assign(l,{key:t}),a(l)},f.onerror=function(e){return i(e)}}),function(){return u.apply(this,arguments)});var u;if(l=A.temp[t])return a(l),!0;yield c()}),function(e,t){return a.apply(this,arguments)}));var a},y=(h=_asyncToGenerator(function*(e){let t=yield f(e);return!!t&&(!!t.version&&(!(Date.now()>t.version)&&t.value))}),function(e){return h.apply(this,arguments)});var h;const p=(m=_asyncToGenerator(function*(e){let t=yield f(e);return t?t.version:0}),function(e){return m.apply(this,arguments)});var m;const g=(b=_asyncToGenerator(function*(e,t){let n=d(e,"css");return yield f(A.getUrl(n,"css"),t||"data")}),function(e,t){return b.apply(this,arguments)});var b;const v=(w=_asyncToGenerator(function*(e,t){let n=d(e,"html");return yield f(A.getUrl(n,"html"),t||"data")}),function(e,t){return w.apply(this,arguments)});var w;const D=(C=_asyncToGenerator(function*(e,t){let n=d(e,"js");return yield f(A.getUrl(n,"js"),t||"data")}),function(e,t){return C.apply(this,arguments)});var C;const T=(j=_asyncToGenerator(function*(e){let t=yield f(e);return!!t&&((e,t)=>{let n=[],a=new Uint8Array(e);for(let e=0;e<a.byteLength;e++)n.push(String.fromCharCode(a[e]));return`data:image/${t};base64,${window.btoa(n.join(""))}`})(t.value,(e=>{let t=e.replace(/^.*\.(\w*)[?#]*.*$/,"$1");return e!==t&&t})(e)||"jpeg")}),function(e){return j.apply(this,arguments)});var j;(function(){return!!(e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB)||(console&&console.log("您的浏览器不支持indexedDB，请使用现代浏览器，例如chrome,firefox等."),!1)})&&(this.open=o,this.close=l,this.delete=c,this.setItem=u,this.getItem=f,this.setValue=u,this.getValue=y,this.getEndTime=p,this.getCss=g,this.getHtml=v,this.getJs=D,this.getBase64=T,this.temp={});let A=this};e.localDB=c;let u,d=(e,t)=>e&&t?e.replace(/^(\s*)|(\s*)$/g,"").replace(`(.${t})`,""):e&&!t?e.replace(/^(\s*)|(\s*)$/g,"").replace(`(.${l(e)}`,""):e,f=function(s){let u=void 0!==s?s:{};this.dataMin=r,this.dataDir=u.dataDir||"",this.dataCss=u.dataCss||[],this.dataJs=u.dataJs||[],this.dataFont=u.dataFont||[],this.dataFile=u.dataFile||[],this.lifeCycle="object"==typeof u.lifeCycle?u.lifeCycle[0]:u.lifeCycle||24,this.cycleDelay="object"==typeof u.lifeCycle?u.lifeCycle[1]:u.cycleDelay||0,this.dataActive=u.dataActive||b,this.callback=u.callback||null,this.multiLoad=u.multiLoad||".min"===r,this.showLog=u.showLog||!1,this.preload=void 0!==u.preload?u.preload:0;let f=function(e,t){t.length>0&&t.forEach(function(t){e.setAttribute(t.split("=")[0],t.split("=")[1])})};void 0===e.headLoaderCache&&(e.headLoaderCache={});let y=function(e,t,n){return E.dataActive&&["js","css"].includes(t)?`${E.dataDir}${t}${r}/${e.split("|")[0]}`.replace("."+(n||t),"")+r+"."+(n||t):e},h=function(e,t){return["js","css"].includes(t)?(E.dataDir+t+r+"/"+e.split("|")[0]).replace("."+t,"")+r+"."+t:e},p=function(e,t){return new Promise((r,o)=>{if(!e)return r(2);Number(e.version)<Number(E.requestVersion)?""===e.etag?r(2):(n=t,new Promise((e,t)=>{let r=new a;r.open("HEAD",n,!0),r.send(),r.onreadystatechange=function(){4===Number(r.readyState)&&200===Number(r.status)&&e(r.getResponseHeader("etag")||r.getResponseHeader("last-modified")||"")},r.onerror=(e=>t(e))})).then(t=>{e.etag===t?r(1):r(2)}).catch(e=>o(e)):r(0)});var n},m=(g=_asyncToGenerator(function*(e,t){return new Promise(function(n,r){if((e=>/^http[s]?:\/\//.test(e))(e))return"js"===t?L(e):"css"===t&&S(e),n("success");let i=y(e,t)+(e.indexOf("?")>=0?"&v=":"?v=")+E.requestVersion,s=h(e,t),c=(u=_asyncToGenerator(function*(e,t){let c={};if(Object.assign(c,{key:s,value:t?t.value:"",etag:t?t.etag:"",version:t?t.version:E.requestVersion,exception:!!t&&t.exception}),0===e)E.db.temp[s]=c,n("success");else if(1===e)E.db.temp[s]=c,n("success"),c.version=E.requestVersion,yield E.db.setItem(c);else if(2===e){let e=l(c.key),t=["js","ts","css","svg","text","xml","json","html","htm"].includes(e)?"text":"arraybuffer",u=function(e){c.version=0,c.value="",c.exception={code:e,detail:`Error-${e} ! ${o[e]||""}`},E.db.temp[s]=c,n(`${c.key} 返回 ${c.exception.detail}`)};if(window.fetch){let e=yield fetch(i).catch(function(e){return u("TypeError"===e.name?0:e.name)});if(e.ok){let a="arraybuffer"===t?yield e.arrayBuffer():yield e.text();Object.assign(c,{value:a,etag:e.headers.get("etag")||e.headers.get("last-modified")||"",version:E.requestVersion,exception:!1}),E.db.temp[s]=c,n("success"),yield E.db.setItem(c)}else u(e.status)}else{let e=new a;e.open("GET",i),e.responseType=t,e.send(),e.onreadystatechange=_asyncToGenerator(function*(){if(4!==Number(e.readyState))return!1;if(E.showLog&&D++,200===Number(e.status)){let a=e["arraybuffer"===t?"response":"responseText"];Object.assign(c,{value:a,etag:e.getResponseHeader("etag")||e.getResponseHeader("last-modified")||"",version:E.requestVersion,exception:!1}),E.db.temp[s]=c,n("success"),yield E.db.setItem(c)}else u(e.status),e.abort()}),e.onerror=function(t){e.abort(),r(t)}}}}),function(e,t){return u.apply(this,arguments)});var u;E.db.getItem(s).then(function(e){p(e,i).then(function(t){return c(t,e)}).catch(function(e){return console.error(e)})})})}),function(e,t){return g.apply(this,arguments)});var g;let v=function(e){if(""!==r)return Function(Object.values(e).join(";"))(),!0;let n=document.createElement("script"),a=1===Object.keys(e).length?Object.keys(e)[0]:"_js"+E.requestVersion;a=a.split("|")[0].replace(/(\.css)|(\.min)/g,""),n.setAttribute("type","text/javascript"),n.setAttribute("data-name",a),n.innerHTML=Object.values(e).join(";"),t.appendChild(n)},w=function(e){let n,a=1===Object.keys(e).length?Object.keys(e)[0]:"_css"+E.requestVersion;if(a=a.split("|")[0].replace(/(\.css)|(\.min)/g,""),""!==r&&null!==(n=t.querySelector(`[data-name=${a}]`)))return n.innerHTML+=Object.values(e).join(" "),!1;(n=document.createElement("style")).setAttribute("type","text/css"),n.setAttribute("data-name",a),n.innerHTML=Object.values(e).join(" "),t.appendChild(n)},T=(j=_asyncToGenerator(function*(e){Object.keys(e).forEach(function(t){document.fonts.add(new FontFace(t.replace(/^.*\/|\..*$/g,""),e[t]))})}),function(e){return j.apply(this,arguments)});var j;let L=function(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let n=document.createElement("script");f(n,e.split("|").splice(1)),n.src=0===e.indexOf("http")?e.split("|")[0]:e.split("|")[0].replace(".js","")+r+".js?v="+E.requestVersion,t.appendChild(n)},S=function(e){if(0===document.getElementsByTagName("HEAD").length)return!1;let n=document.createElement("link");f(n,e.split("|").splice(1)),n.type="text/css",n.rel="stylesheet",n.media="screen",n.href=0===e.indexOf("http")?e.split("|")[0]:e.split("|")[0].replace(".css","")+r+".css?v="+E.requestVersion,t.appendChild(n)},x=(B=_asyncToGenerator(function*(e,t){return new Promise(function(n,a){let r,o={JS:v,CSS:w,FONT:T}[t.toUpperCase()],i={},l=[];e.forEach(function(e){i[e]="";l.push(new Promise(function(n,a){r=h(e,t);let o=E.db.temp[r]?E.db.temp[r]:"";i[e]=o.value,E.returnData.push({key:e,value:o.value||"",version:o.version,etag:o.etag,exception:o.exception||!1}),n("success")}))}),Promise.all(l).then(function(){return 1===E.preload?(n("success"),!1):o?(o(i),void n("success")):n("页面写入仅支持js、css、font")}).catch(function(e){return a(e)})})}),function(e,t){return B.apply(this,arguments)});var B;let _=function(e,t){return e&&0!==e.length?new Promise(E.multiLoad?function(e,t){return n=_asyncToGenerator(function*(n){let a=new Array(e.length).fill(0).map(function(n,a){return new Promise((r=_asyncToGenerator(function*(n){yield m(e[a],t),n("success")}),function(e){return r.apply(this,arguments)}));var r});var r;Promise.all(a).then((r=_asyncToGenerator(function*(a){yield x(e,t),n("success")}),function(e){return r.apply(this,arguments)}))}),function(e){return n.apply(this,arguments)};var n}(e,t):function(e,t){return n=_asyncToGenerator(function*(n){let a=0,r=(o=_asyncToGenerator(function*(){if(a>=e.length)return!0;yield m(e[a],t),yield x([e[a]],t),yield r(a++)}),function(){return o.apply(this,arguments)});var o;yield r(),n("success")}),function(e){return n.apply(this,arguments)};var n}(e,t)):new Promise(e=>e("success"))};var F,G,$,k;this.returnData={},this.run=_asyncToGenerator(function*(){return"Array"===n(this.lifeCycle)&&(E.cycleDelay=this.lifeCycle[1],E.lifeCycle=this.lifeCycle[0]),E.requestVersion=i(E.lifeCycle,E.cycleDelay),E.db=new c({lifeCycle:E.lifeCycle,cycleDelay:E.cycleDelay}),this.db.temp={},this.db.getUrl=y,this.returnData={},E.returnData=[],E.dataCss=E.dataCss.map(function(e){return d("_css"===e?A:e,"css")}),E.dataCss=Array.from(new Set(E.dataCss)),E.dataJs=E.dataJs.map(function(e){return d("_js"===e?A:e,"js")}),E.dataJs=Array.from(new Set(E.dataJs)),E.dataFont=E.dataFont.map(function(e){return d(e,"")}),E.dataFont=Array.from(new Set(E.dataFont)),E.dataFile=E.dataFile.map(function(e){return d(e,"")}),E.dataFile=Array.from(new Set(E.dataFile)),yield E.db.open(),yield _(E.dataCss,"css"),yield _(E.dataFont,"font"),yield _(E.dataJs,"js"),yield _(E.dataFile,""),E.showLog&&function(){let t=Date.now()-C;e.headLoaderHistory=void 0!==e.headLoaderHistory?e.headLoaderHistory:[],void 0!==e.showLogTimeout&&clearTimeout(e.showLogTimeout),e.showLogTimeout=setTimeout(()=>{D>0&&(e.headLoaderHistory=e.headLoaderHistory.concat(new Array(D-1).fill(0),t));let n=0,a=0;e.headLoaderHistory.length>0&&(n=e.headLoaderHistory.reduce((e,t)=>e+t),a=Math.ceil(n/e.headLoaderHistory.length)),console.log("当前页面使用headLoader"+(E.multiLoad?"并行":"串行")+"网络请求%c"+D+"个%cJS/CSS文件，程序用时%c"+t+"毫秒%c，累计网络请求%c"+e.headLoaderHistory.length+"个%cJS/CSS文件，单文件平均用时%c"+a+"毫秒","color:#1b8884","","color:#1b8884","","color:#1b8884","","color:#1b8884","")},3e3)}(),"function"==typeof E.callback&&E.callback.call(E,E.returnData),0!==E.returnData.length&&(1===E.returnData.length?E.returnData[0]:E.returnData)}),this.loadFile=(F=_asyncToGenerator(function*(e,t){return E.dataCss=[],E.dataJS=[],E.dataFont=[],E.dataFile=[e].flat(),E.preload=1,yield E.run()}),function(e,t){return F.apply(this,arguments)}),this.loadJs=(G=_asyncToGenerator(function*(e){return E.dataCss=[],E.dataJs=[e].flat(),E.dataFont=[],E.dataFile=[],E.preload=1,yield E.run()}),function(e){return G.apply(this,arguments)}),this.loadCss=($=_asyncToGenerator(function*(e){return E.dataCss=[e].flat(),E.dataJS=[],E.dataFont=[],E.dataFile=[],E.preload=1,yield E.run()}),function(e){return $.apply(this,arguments)}),this.loadFont=(k=_asyncToGenerator(function*(e){return E.dataCss=[],E.dataJS=[],E.dataFont=[e].flat(),E.dataFile=[],E.preload=1,yield E.run()}),function(e){return k.apply(this,arguments)}),this.nextLife=function(e,t){let a,r;return"Array"===n(E.lifeCycle)?(a=E.lifeCycle[0],r=E.lifeCycle[1]):"Number"===n(E.lifeCycle)&&(a=e||E.lifeCycle,r=t||E.cycleDelay),new Date(i(a,r)).toLocaleString()};let E=this};e.headLoader=f,e.hLoader=f;let y,h=[],p=[],m=[],g=[],b=!1,v=24,w=0,D=1,C=Date.now();u=document.currentScript;let T=console.log&&".min"!==r,j=!1,A=(window===window.top?location.pathname:window.frameElement.getAttribute("src")||window.frameElement.pathname||"/404.html").replace(/^(.*\/)(.*)(\.html)([?]*)(.*)$/,"$1$2$4$5");"/"===A.substr(-1)&&(A+="index"),A=0===A.indexOf("/")?A.substr(1):A,u.hasAttribute("data-active")?b=["true",""].includes(u.getAttribute("data-active")):T&&console.log('%c友情提示:script标签未设置"data-active"属性,默认为false.',"color:#69F;"),u.hasAttribute("data-lifecycle")&&(v=Number(u.getAttribute("data-lifecycle"))),u.hasAttribute("data-cycledelay")?w=Number(u.getAttribute("data-cycledelay")):T&&console.log('%c友情提示:script标签未设置"data-lifeCycle"属性,默认为0(开发环境)或24小时(线上环境）.',"color:#69F;"),u.hasAttribute("data-dir")?y=u.getAttribute("data-dir"):T&&console.log('%c友情提示:script标签未设置"data-dir"属性.',"color:#69F;"),u.hasAttribute("data-css")?p=u.getAttribute("data-css").split(","):T&&console.log('%c友情提示:script标签未设置"data-css"属性',"color:#69F;"),u.hasAttribute("data-js")?h=u.getAttribute("data-js").split(","):T&&console.log('%c友情提示:script标签未设置"data-js"属性',"color:#69F;"),u.hasAttribute("data-font")&&(m=u.getAttribute("data-font").split(",")),u.hasAttribute("data-file")&&(g=u.getAttribute("data-file").split(",")),u.hasAttribute("data-showlog")&&(j=["true",""].includes(u.getAttribute("data-showlog"))),""!==r&&u.remove();const L=(S=_asyncToGenerator(function*(){let e=u.src.replace(/.+\.js\?v=(.*)/,"$1");if(e&&".min"===r){let t=new f;t.lifeCycle=876e3,yield t.run();try{if((yield t.db.getValue("srcSearch"))!==e){console.log("检测到新版本，准备清除旧缓存...");try{yield t.db.delete(),console.log("成功删除旧数据库"),yield t.db.setValue("srcSearch",e),localStorage.clear()}catch(e){console.warn("删除数据库时出错:",e.message)}}}catch(e){console.error("版本检查出错:",e)}}}),function(){return S.apply(this,arguments)});var S;const x=(B=_asyncToGenerator(function*(){if(0===document.getElementsByTagName("HEAD").length)return!1;let e=new f;e.lifeCycle=v,e.cycleDelay=w,y&&(e.dataDir=y),p.length>0&&(e.dataCss=p),h.length>0&&(e.dataJs=h),m.length>0&&(e.dataFont=m),g.length>0&&(e.dataFile=g),e.showLog=j,yield e.run()}),function(){return B.apply(this,arguments)});var B;L().then(x)};headLoaderSource(),getHeaderLoader=(e=>`function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,o){try{var s=t[r](o),i=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(i).then(function(e){a("next",e)},function(e){a("throw",e)});e(i)}("next")})}} const headLoaderSource=${headLoaderSource};headLoaderSource()`);
